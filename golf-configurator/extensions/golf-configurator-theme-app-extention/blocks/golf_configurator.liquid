<!-- Build programmatic hand links from variation products -->
{% assign current_hand_raw = product.metafields.custom.variation_value.value %}
{% assign current_hand_programmatic = current_hand_raw | downcase | replace: ' ', '-' %}

{% assign right_hand_link = '' %}
{% assign left_hand_link = '' %}

{% comment %}DEBUG: Check what we have{% endcomment %}
{% assign variation_products = product.metafields.custom.variation_products.value %}

{% if variation_products and variation_products != blank %}
  {% for variation_product in variation_products %}
    {% assign full_product = all_products[variation_product.handle] %}
    {% if full_product %}
      {% assign product_hand = full_product.metafields.custom.variation_value.value %}

      {% if product_hand == 'Right Handed' %}
        {% assign right_hand_link = '/products/' | append: variation_product.handle %}
      {% elsif product_hand == 'Left Handed' %}
        {% assign left_hand_link = '/products/' | append: variation_product.handle %}
      {% endif %}
    {% endif %}
  {% endfor %}
{% endif %}

<!-- Golf Configurator App Container -->
<div
  id="golf-configurator"
  data-bundle-parent-product="{{ block.settings.bundle_parent_product.handle | default: '' }}"
  data-shaft-products='{{ block.settings.shaft_products | json | escape }}'
  data-current-hand="{{ current_hand_programmatic }}"
  data-right-hand-link="{{ right_hand_link }}"
  data-left-hand-link="{{ left_hand_link }}"
>
  <!-- The Preact app will be mounted here -->
  <div
    class="loading-state"
    style="padding: 2rem; text-align: center; background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px;"
  >
    <p>Loading Golf Configurator...</p>
  </div>
</div>

<!-- Load Golf Configurator CSS -->
{{ 'golf-configurator.bundle.css' | asset_url | stylesheet_tag }}

<!-- Load Golf Configurator JavaScript -->
<script src="{{ 'golf-configurator.bundle.js' | asset_url }}" defer></script>

<!-- Initialize the configurator when the script loads -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // The golf configurator will auto-initialize when the bundle loads
    console.log('üèåÔ∏è Golf Configurator block loaded - Version: {{ "now" | date: "%Y%m%d-%H%M%S" }}');



  });
</script>

{% schema %}
{
  "name": "Golf Configurator 2",
  "target": "section",
  "settings": [
    {
      "type": "product",
      "id": "bundle_parent_product",
      "label": "Bundle Parent Product",
      "info": "Select the main iron set product that will be used as the bundle parent (e.g., origin-combo-length-chrome)"
    },
    {
      "type": "product_list",
      "id": "shaft_products",
      "label": "Shaft Products",
      "info": "Select the products that should be available as shaft options in the configurator"
    }
  ]
}
{% endschema %}
